{% extends 'posts/base.html' %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
    <h1>{{ post.title }}</h1>
    <p class="post-meta">Por: {{ post.author.username }} em {{ post.created_at|date:"d M Y" }}</p>
    <hr>
    <div>
        {{ post.content|linebreaks }}
    </div>
    <hr>

    <h2>Comentários ({{ comments.count }})</h2>
    <div id="comments-section">
        {% for comment in comments %}
            <div class="comment">
                <p><strong>{% if comment.user %}{{ comment.user.username }}{% else %}{{ comment.author_anonymous|default:'Anónimo' }}{% endif %}</strong>
                <span style="color: #888; font-size: 0.9em;">em {{ comment.created_at|date:"d M Y, H:i" }}</span></p>
                <p>{{ comment.text|linebreaks }}</p>
            </div>
        {% empty %}
            <p>Ainda não há comentários. Seja o primeiro a comentar!</p>
        {% endfor %}
    </div>
    <hr>

    <h2>Deixe um comentário</h2>
    <form method="post">
        {% csrf_token %}
        {% if user.is_authenticated %}
            <p>Comentando como: <strong>{{ user.username }}</strong></p>
            <div style="display:none;">{{ form.author_anonymous }}</div>
            <p>{{ form.text.label_tag }}</p>
            <p>{{ form.text }}</p>
        {% else %}
            {{ form.as_p }}
        {% endif %}
        <button type="submit">Enviar Comentário</button>
    </form>
{% endblock %}